---
title: "Hotelling-TÂ² based Variable Selection in Partial Least Square (PLS)"
output: html_notebook
---

# 1 Libraries
```{r}
library(readr)
library(tidyverse)
library(rospca)
library(caret)

base_size <- 14
ggplot2::theme_bw(base_size = base_size,
         base_line_size = base_size / 22,
         base_rect_size = base_size / 15
         ) %>% 
  theme_set()
```

# 2 Data
```{r}
mydata <- read_csv("dataLIBS.csv")
mydata %<>% rename(spectra = No_spectra,
                   points = No_rep,
                   Ca = `FRG - Calcium - {Calcination-ICP} - [%]`)
```

## 2.1 Missing values
```{r}
mydata %<>%
  na_if(0) %>%
  drop_na(Ca)
  
missing_lambda <- colnames(mydata)[colSums(is.na(mydata)) > 0]
mydata %<>% select(-all_of(missing_lambda))
```

## 2.2 Prepocessing the spectral data
```{r}
spec_avg <- mydata %>%
  select(-spectra, -points) %>%
  aggregate(by = list(mydata$spectra), FUN = mean) %>%
  rename(spectra = Group.1) %>%
  as_tibble()
  
spec_avg %>%
  select(1, 1:25) %>%
  arrange(spectra) %>%
  glimpse()
```

## 2.3 Removing observations flagged as outliers 
```{r}
# spec_avg %<>% filter(!spectra %in% c("99379", "99387", "1103330"))
```

# 3 Modeling 
```{r}
X <- spec_avg %>% select(-spectra, -Ca)
y <- spec_avg$Ca %>% as.numeric()
```

## 3.1 ROBPCA
```{r}
source("robpca.R")
```

## 3.2 PLS-R
```{r}
source("plsr.R")
```

## 3.3 Hotelling T-squared variable selection
```{r}
source("hotellingTsq_varSelec.R")
```
